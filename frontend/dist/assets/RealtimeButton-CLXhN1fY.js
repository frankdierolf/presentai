import{r as f,M as I,f as s,o as i,g as x,i as k,n as C,t as N,K as U,F as z,U as K}from"./modules/vue-BFdwI2wm.js";import{u as W}from"./slidev/context-DjG_tHFe.js";import"./monaco/bundled-types-CveBi5OJ.js";import{_ as q,k as G}from"./index-DUrDUDvJ.js";const H={class:"realtime-container"},Y=["disabled"],Q={key:0},X={key:1},Z={key:2},ee={key:3},te={key:0,class:"status"},oe={key:0},ae={key:1},ne={key:2,class:"transcript"},se={key:3,class:"notifications"},ie={__name:"RealtimeButton",setup(re){W();const E=G(),p=f(!1),m=f(!1),g=f(!1),h=f(!1),n=f(""),b=f(""),_=f([]);let c=null,l=null,a=null;const w="https://backend.presento.app";let V=0;function r(t,e="info"){const o={id:++V,message:t,type:e,timestamp:Date.now()};_.value.push(o),setTimeout(()=>{const d=_.value.findIndex(u=>u.id===o.id);d>-1&&_.value.splice(d,1)},3e3)}function $(t){try{t==="next"?(E.next(),r("Navigated to next slide","success")):t==="previous"&&(E.prev(),r("Navigated to previous slide","success"))}catch(e){console.error("Navigation error:",e),r("Failed to navigate slide","error")}}function F(){h.value=!0,r("Voice mode enabled - you will hear AI responses","success"),a&&(a.volume=1,a.muted=!1)}function R(){h.value=!1,r("Voice mode disabled - silent mode active","info"),a&&(a.volume=0,a.muted=!0)}async function J(){try{const t=await fetch(`${w}/session`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return(await t.json()).client_secret.value}catch(t){throw console.error("Failed to fetch ephemeral token:",t),t}}async function P(){try{p.value=!0,n.value="Getting ephemeral token...";const t=await J();n.value="Setting up voice commands...",c=new RTCPeerConnection,n.value="Requesting microphone access...";const e=await navigator.mediaDevices.getUserMedia({audio:!0}),o=e.getTracks()[0];c.addTrack(o,e),l=c.createDataChannel("oai-events"),l.addEventListener("message",j),l.addEventListener("open",()=>{console.log("Data channel opened"),m.value=!0,p.value=!1,n.value='Voice commands ready! Say "next slide", "previous slide", "enable voice", or "disable voice"'}),c.addEventListener("track",L=>{const[M]=L.streams;console.log("Received remote audio stream"),a||(a=new Audio,a.autoplay=!0),a.srcObject=M,h.value?(a.volume=1,a.muted=!1):(a.volume=0,a.muted=!0),a.play().catch(B=>{console.error("Error playing audio:",B)})}),n.value="Establishing connection...";const d=await c.createOffer();await c.setLocalDescription(d);const v=await fetch("https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview-2025-06-03",{method:"POST",body:d.sdp,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/sdp"}});if(!v.ok)throw new Error(`SDP exchange failed: ${v.status}`);const S={type:"answer",sdp:await v.text()};await c.setRemoteDescription(S),r("Voice commands activated!","success")}catch(t){console.error("Failed to initialize WebRTC:",t),n.value=`Connection failed: ${t.message}`,p.value=!1,r(`Connection failed: ${t.message}`,"error")}}function j(t){try{const e=JSON.parse(t.data);switch(e.type){case"session.created":console.log("Session created successfully"),n.value="Voice commands ready!";break;case"input_audio_buffer.speech_started":g.value=!0,n.value="Listening for commands...";break;case"input_audio_buffer.speech_stopped":g.value=!1,n.value="Processing command...";break;case"conversation.item.input_audio_transcription.completed":e.transcript&&(b.value=e.transcript);break;case"response.done":if(e.response.output&&e.response.output.length>0){const o=e.response.output[0];if(o.type==="function_call")switch(o.name){case"navigate_slide":D(o);break;case"enable_voice":O(o,"enable");break;case"disable_voice":O(o,"disable");break}}n.value="Ready for next command...";break;case"error":console.error("Server error:",e),n.value=`Error: ${e.message}`,r(`AI Error: ${e.message}`,"error");break}}catch(e){console.error("Failed to parse server event:",e)}}async function D(t){try{console.log("Navigation call received:",t);const e=JSON.parse(t.arguments),{direction:o,confirmation:d}=e,u=await fetch(`${w}/api/tool/navigate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({direction:o,confirmation:d})}),y=await u.json();if(u.ok){$(o);const v={type:"conversation.item.create",item:{type:"function_call_output",call_id:t.call_id,output:JSON.stringify(y)}};l.send(JSON.stringify(v));const S={type:"response.create"};l.send(JSON.stringify(S))}else console.error("Navigation execution failed:",y),r("Failed to execute navigation","error")}catch(e){console.error("Failed to handle navigation call:",e),r("Error processing navigation","error")}}async function O(t,e){try{console.log("Voice control call received:",t,e);const d=await fetch(`${w}${e==="enable"?"/api/tool/enable-voice":"/api/tool/disable-voice"}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})}),u=await d.json();if(d.ok){e==="enable"?F():R();const y={type:"conversation.item.create",item:{type:"function_call_output",call_id:t.call_id,output:JSON.stringify(u)}};l.send(JSON.stringify(y));const v={type:"response.create"};l.send(JSON.stringify(v))}else console.error("Voice control execution failed:",u),r("Failed to execute voice control","error")}catch(o){console.error("Failed to handle voice control call:",o),r("Error processing voice control","error")}}function T(){c&&(c.close(),c=null),l&&(l.close(),l=null),a&&(a.pause(),a.srcObject=null,a=null),m.value=!1,p.value=!1,g.value=!1,h.value=!1,n.value="",b.value=""}async function A(){m.value?T():await P()}return I(()=>{T()}),(t,e)=>(i(),s("div",H,[x("button",{onClick:A,disabled:p.value,class:C([{connecting:p.value,connected:m.value,recording:g.value},"realtime-button"])},[p.value?(i(),s("span",Q,"Connecting...")):m.value&&!g.value?(i(),s("span",X,"🎤 Voice Commands Active")):g.value?(i(),s("span",Z,"🎤 Listening...")):(i(),s("span",ee,"🗣️ Enable Voice Commands"))],10,Y),n.value?(i(),s("div",te,N(n.value),1)):k("v-if",!0),m.value?(i(),s("div",{key:1,class:C(["voice-mode-indicator",{"voice-enabled":h.value}])},[h.value?(i(),s("span",oe,"🔊 Voice Mode: ON")):(i(),s("span",ae,"🔇 Voice Mode: OFF"))],2)):k("v-if",!0),b.value?(i(),s("div",ne,[e[0]||(e[0]=x("strong",null,"You said:",-1)),U(" "+N(b.value),1)])):k("v-if",!0),_.value.length>0?(i(),s("div",se,[(i(!0),s(z,null,K(_.value,o=>(i(),s("div",{key:o.id,class:C(`notification notification-${o.type}`)},N(o.message),3))),128))])):k("v-if",!0)]))}},pe=q(ie,[["__scopeId","data-v-32171c51"]]);export{pe as _};
